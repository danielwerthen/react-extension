{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["export type ExtensionFunction<P extends {}> = (\n  tagName: React.FunctionComponent<P> | React.ComponentClass<P> | string,\n  props?: (React.Attributes & P) | null,\n  ...children: React.ReactNode[]\n) => [\n  React.FunctionComponent<P> | React.ComponentClass<P> | string,\n  (React.Attributes & P) | null | undefined,\n  React.ReactNode[]\n];\n\nconst STORE_KEY = Symbol.for(\"@dwerthen/react-extension/Store\");\nconst globalSymbols = Object.getOwnPropertySymbols(global);\nconst hasContext = globalSymbols.indexOf(STORE_KEY) > -1;\n\nif (!hasContext) {\n  (global as any)[STORE_KEY] = [];\n}\n\nexport const store: [ExtensionFunction<{}>, Symbol][] = (global as any)[\n  STORE_KEY\n];\n\nexport const applyExtensions = (\n  createElement: any,\n  type: React.ElementType,\n  props: Object,\n  ...children: React.ReactNode[]\n) => {\n  const [nextTag, nextProps, nextChildren] = store.reduce(\n    (\n      [tag, props, children]: [\n        React.FunctionComponent<{}> | React.ComponentClass<{}> | string,\n        (React.Attributes & {}) | null | undefined,\n        React.ReactNode[]\n      ],\n      [fn]\n    ) => fn(tag, props, ...children),\n    [type, props, children]\n  );\n  return createElement(nextTag, nextProps, ...nextChildren);\n};\n\nexport function extend(reactModule: any) {\n  const oldCE = reactModule.createElement;\n  reactModule.createElement = (...args: any) =>\n    (applyExtensions as any)(oldCE, ...args);\n}\n\nexport type TeardownCallback = () => void;\n\nexport function registerExtension<P extends {}>(\n  fn: ExtensionFunction<P>\n): TeardownCallback {\n  const id = Symbol();\n  store.unshift([fn as ExtensionFunction<{}>, id]);\n  return () => {\n    const idx = store.findIndex(([_fn, sym]) => sym === id);\n    if (idx > -1) {\n      store.splice(idx, 1);\n    }\n  };\n}\n\nexport function registerPropExtension<P extends {}, T extends {}>(\n  fn: (props: P) => T\n) {\n  return registerExtension((tagName, props?, ...children) => {\n    return [\n      tagName,\n      typeof props === \"object\" ? fn(props as P) : props,\n      children,\n    ];\n  });\n}\n"],"names":["STORE_KEY","Symbol","Object","getOwnPropertySymbols","global","indexOf","store","applyExtensions","createElement","type","props","reduce","nextTag","nextProps","nextChildren","registerExtension","fn","id","unshift","idx","findIndex","splice","reactModule","oldCE","tagName"],"mappings":"AAUA,IAAMA,EAAYC,WAAW,mCACPC,OAAOC,sBAAsBC,QAClBC,QAAQL,IAAc,IAGpDI,OAAeJ,GAAa,IAGlBM,IAAAA,EAA4CF,OACvDJ,GAGWO,EAAkB,SAC7BC,EACAC,EACAC,SAG2CJ,EAAMK,OAC/C,kEAQA,CAACF,EAAMC,+BATFE,OAASC,OAAWC,OAW3B,OAAON,gBAAcI,EAASC,UAAcC,cAW9BC,EACdC,GAEA,IAAMC,EAAKhB,SAEX,OADAK,EAAMY,QAAQ,CAACF,EAA6BC,eAE1C,IAAME,EAAMb,EAAMc,UAAU,0BAAwBH,IAChDE,GAAO,GACTb,EAAMe,OAAOF,EAAK,sDAhBDG,GACrB,IAAMC,EAAQD,EAAYd,cAC1Bc,EAAYd,cAAgB,kBACzBD,gBAAwBgB,0GAmB3BP,GAEA,OAAOD,EAAkB,SAACS,EAASd,GACjC,MAAO,CACLc,EACiB,iBAAVd,EAAqBM,EAAGN,GAAcA"}